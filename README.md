# calcpipe - 標準入力式計算コマンド

[![test](https://github.com/mafu6333/robosys2025-command/actions/workflows/test.yml/badge.svg)](https://github.com/mafu6333/robosys2025-command/actions/workflows/test.yml)

---

## 概要

ロボットシステム学（robosys2025）の課題として作成した  
標準入力から与えた数式を1行ずつ計算するコマンド `calcpipe` と、そのテストをまとめたディレクトリです。

---

## 機能

- 標準入力から数式を受け取り計算結果を出力
- 空行および `#` から始まるコメント行は無視
- エラーが出た行は行番号付きで標準エラーに表示
- 危険なPythonコードは実行できないよう制限

---

## 実行方法

### 1. インストール

```bash
git clone https://github.com/mafu6333/robosys2025_command.git
cd calcpipe
chmod +x calcpipe
```

### 2. 実行
```bash
echo "1+2" | ./calcpipe
```

### 3. 実行例
```bash
printf "1+2\n3*4\nsqrt(9)\npi*2\n" | ./calcpipe
```

出力：
```bash
3
12
3.0
6.283185307179586
```

### エラー例：
```bash
printf "1+2\nabc\n3+4\n" | ./calcpipe

[error] line 2: abc (Syntax error)
```
---

## 対応している演算

本コマンドでは、標準入力から与えられた数式に対して以下の演算のみを許可している。

- 四則演算  
  `+`（加算）、`-`（減算）、`*`（乗算）、`/`（除算）

- 累乗  
  `**`

- 括弧による優先順位制御  
  `( )`

- 数値定数  
  `pi`, `e`

- 数学関数  
  `sqrt(x)` のみ対応

※ 上記以外の関数呼び出しや変数、Pythonコードは安全性確保のため実行できない。

---

## オプション

| オプション | 説明 |
|------------|------|
| --quiet | エラー内容を表示しない |
| --fail-fast | エラー発生時にその場で終了する |

---

## 必要なソフトウェア

- Python 3.7～3.12（テスト済みバージョン）

---

## テスト環境/方法

- Ubuntu 22.04

以下のテストスクリプトを用いて動作確認を行う。
### 1. テストの実行方法
```bash
./test.bash
```

### 2. テストで確認している内容

テストでは、以下の点を確認しています。
- 標準入力から数式を正しく読み取れること
- 計算結果が正しいこと
- 空行およびコメント行が無視されること
- 不正な入力行に対して、行番号付きのエラーが標準エラーに出力されること- 危険なPythonコードが実行されないこと

### 3. テスト成功・失敗の判定
* すべてのテストが成功した場合

終了コード 0 を返します
* いずれかのテストに失敗した場合

終了コードは 0 以外になります

失敗したテスト内容が表示されます

例：
```text
Test 1: PASS
Test 2: FAIL
```
この場合、 FAIL と表示されたテストが問題箇所です。

---

## ライセンス

このソフトウェアは BSD 3条項ライセンスのもとで再頒布および使用が可能です。  
詳細は LICENSE ファイルを参照してください。

© 2026 Fumiyori Manaka
